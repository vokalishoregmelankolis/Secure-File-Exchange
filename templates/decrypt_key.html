{% extends "base.html" %}

{% block title %}Decrypt Key - SECURE VAULT{% endblock %}

{% block content %}
<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card" style="background: var(--valorant-bg-secondary); border: 1px solid var(--valorant-accent);">
                <div class="card-header" style="background: rgba(255, 70, 84, 0.1); border-bottom: 1px solid var(--valorant-red);">
                    <h3 style="color: var(--valorant-red); margin: 0;">
                        <i class="bi bi-unlock"></i> DECRYPT SYMMETRIC KEY
                    </h3>
                </div>
                <div class="card-body">
                    <!-- File Information -->
                    <div class="mb-4 p-3" style="background: rgba(0, 245, 255, 0.05); border-left: 3px solid var(--valorant-accent-blue); border-radius: 4px;">
                        <h5 style="color: var(--valorant-accent-blue); margin-bottom: 1rem;">
                            <i class="bi bi-file-earmark-lock"></i> File Details
                        </h5>
                        <div class="row">
                            <div class="col-md-6">
                                <p style="color: var(--text-secondary); margin-bottom: 0.5rem;">
                                    <strong>File Name:</strong>
                                </p>
                                <p style="color: var(--text-primary); margin-bottom: 1rem;">
                                    {{ file.original_filename }}
                                </p>
                            </div>
                            <div class="col-md-6">
                                <p style="color: var(--text-secondary); margin-bottom: 0.5rem;">
                                    <strong>Owner:</strong>
                                </p>
                                <p style="color: var(--text-primary); margin-bottom: 1rem;">
                                    {{ access_request.organization.username }}
                                </p>
                            </div>
                            <div class="col-md-6">
                                <p style="color: var(--text-secondary); margin-bottom: 0.5rem;">
                                    <strong>Algorithm:</strong>
                                </p>
                                <p style="margin-bottom: 1rem;">
                                    <span class="badge" style="background: var(--valorant-red);">{{ file.algorithm }}</span>
                                </p>
                            </div>
                            <div class="col-md-6">
                                <p style="color: var(--text-secondary); margin-bottom: 0.5rem;">
                                    <strong>Approved:</strong>
                                </p>
                                <p style="color: var(--text-primary); margin-bottom: 1rem;">
                                    {{ access_request.processed_at.strftime('%Y-%m-%d %H:%M') if access_request.processed_at else 'N/A' }}
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Security Notice -->
                    <div class="alert" style="background: rgba(255, 70, 84, 0.1); border: 1px solid var(--valorant-red); color: var(--text-primary);">
                        <i class="bi bi-shield-lock"></i>
                        <strong>Security Notice:</strong> Enter your password to decrypt your private key and unwrap the symmetric key for this file. Your password is never stored and the decrypted key is only kept temporarily in your session.
                    </div>

                    <!-- Decrypt Form -->
                    <form method="POST" action="{{ url_for('main.decrypt_key', request_id=access_request.id) }}">
                        {{ form.hidden_tag() }}
                        
                        <div class="mb-3">
                            {{ form.password.label(class="form-label", style="color: var(--text-primary); font-weight: 600;") }}
                            {{ form.password(class="form-control", placeholder="Enter your account password", style="background: var(--valorant-bg-primary); color: var(--text-primary); border: 1px solid var(--valorant-accent);") }}
                            {% if form.password.errors %}
                                <div class="text-danger mt-1">
                                    {% for error in form.password.errors %}
                                        <small>{{ error }}</small>
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>

                        <div class="d-grid gap-2">
                            {{ form.submit(class="btn btn-lg", style="background: var(--valorant-red); color: white; border: none; font-weight: 700; text-transform: uppercase;") }}
                            <a href="{{ url_for('main.my_requests') }}" class="btn btn-secondary">
                                <i class="bi bi-arrow-left"></i> Back to My Requests
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
